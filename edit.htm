<!doctype html>
<html>
  <head>
    <title>AIOT 生態物種即使監測回報裝置網頁系統</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="og:author:email" content="hw@yuanhau.com" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

  </head>
  <script>
    console.log("ID: ${data?.id}");
    console.log("Date: ${formatTime(String(data?.created_at))}");
  </script>
  <body class="justify-center align-center text-center selection:opactiy-[50%] bg-[url(https://s3.yhw.tw/scharchive/bgimage.jpg)] bg-cover bg-no-repeat bg-center">
    <h1 class="text-4xl text-white m-4 p-2">顯示資料</h1>
    <a href="http://${ipport}"><button class="bg-blue-200/70 p-2 rounded-xl hover:bg-blue-300/40 transition-all duration-300">即使影像</button></a>
    <section class="bg-gray-200/70 p-4 m-4 min-w-1/3 w-fit mx-auto rounded-lg shadow-lg backdrop-blur-sm gap-2">
      <h3 class="text-3xl">氣象局</h3>
      <hr/>
      <p class="m-3">測站: <span class="text-sky-700" id="test_station">${data?.cwa_location || "N/A"}</span></p>
      <p class="m-3">天氣狀態: <span class="text-sky-700" id="type">${data?.cwa_type || "N/A"}</span></p>
      <p class="m-3"></p>氣溫: <span class="text-sky-700" id="temp">${data?.cwa_temp ?? "N/A"}°C</span></p>
      <p class="m-3"></p>濕度: <span class="text-sky-700" id="hum">${data?.cwa_hum ?? "N/A"}%</span></p>
      <p class="m-3">
        最高氣溫 <span class="text-sky-700" id="daily_high">${data?.cwa_daily_high ?? "N/A"}°C</span>
      </p>
      <p>
        最低氣溫 <span class="text-sky-700" id="daily_low">${data?.cwa_daily_low ?? "N/A"}°C</span>
      </p>
    </section>
    <section class="bg-gray-200/70 p-4 m-4 min-w-1/3 w-fit mx-auto rounded-lg shadow-lg backdrop-blur-sm">
      <h3>本地</h3>
      <p>氣溫: <span class="text-sky-700" id="local_temp">${data?.local_temp ?? "N/A"}°C</span></p>
      <p>濕度: <span class="text-sky-700" id="local_hum">${data?.local_hum ?? "N/A"}%</span></p>
      <p>
        蠕動馬達:
        <span class="text-sky-700" id="motor_status"
          >${data?.local_jistatus ? "運轉中" : "停止"}</span
        >
      </p>
      <p>紅外線: <span class="text-sky-700" id="light">${gfa() ? "關" : "開"}</span></p>
      <p>
        蠕動馬達 ${data?.local_jistatus ? "<button onclick='fetchRemote() id='jistatus2'>關</button>" : '<button onclick="fetchRemote()" id="jistatus2">開</button>'}</p>
      <p>
        紅外線 ${gfa() ? '<button onclick="fetchGFA()" id="light2">關</button>' : '<button onclick="fetchGFA()" id="light2">開</button>'}
      </p>
    </section>
    <section class="bg-gray-200/70 p-4 m-4 min-w-1/3 w-fit mx-auto rounded-lg shadow-lg backdrop-blur-sm">
      <h3>GPS 定位</h3>
      <p>經度: <span class="text-sky-700" id="gps_lat">${data?.local_gps_lat || "N/A"}</span></p>
      <p>緯度: <span class="text-sky-700" id="gps_long">${data?.local_gps_long || "N/A"}</span></p>
    </section>
    <section class="bg-gray-200/70 p-4 m-4 min-w-1/3 w-fit mx-auto rounded-lg shadow-lg backdrop-blur-sm">
      <h3>偵測到的物種</h3>
      <ul id="detected_list">
        <!--${getList}-->
        ${
          fcja().length > 0
            ? fcja()
                .map(
                  (item) => `
        <li>
          <a href="${item.imageURL}"
            ><div>
              <span>${item.item}</span>
              <br />
              偵測時間: ${formatTime(String(item?.time))}
              <br />
              <!--${item}-->
            </div></a
          >   
        </li>
        `,
                )
                .join("")
            : `
        <li>尚未偵測到物種</li>
        `
        }
      </ul>
    </section>
  </body>
  <script>
    let cwaType = document.getElementById("type").innerText;
    let cwaTemp = document.getElementById("temp").innerText;
    let cwaHum = document.getElementById("hum").innerText;
    let cwaDailyHigh = document.getElementById("daily_high").innerText;
    let cwaDailyLow = document.getElementById("daily_low").innerText;
    let localTemp = document.getElementById("local_temp").innerText;
    let localHum = document.getElementById("local_hum").innerText;
    let motorStatus = document.getElementById("motor_status").innerText;
    let lightStatus = document.getElementById("light").innerText;
    let gpsLat = document.getElementById("gps_lat").innerText;
    let gpsLong = document.getElementById("gps_long").innerText;
    let detectedList = document.getElementById("detected_list").innerText;
    let lightStatus2 = document.getElementById("light2").innerText;
    let jistatus2 = document.getElementById("jistatus2").innerText;
    console.log(cwaType);
    console.log(cwaTemp);
    console.log(cwaHum);
    console.log(cwaDailyHigh);
    console.log(cwaDailyLow);
    console.log(localTemp);
    console.log(localHum);
    console.log(motorStatus);
    console.log(gpsLat);
    console.log(gpsLong);
    console.log(detectedList);  
    const socket = new WebSocket("wss://zb-logger.sch2.top/logger/");
    socket.addEventListener("message", (event1) => {
      const event = JSON.parse(event1.data)[0]; // AI added this
      console.log(event);
      console.log(event.data);
      console.log(event.id);
      console.log(event.created_at);
      cwaType = event.cwa_type;
      cwaTemp = event.cwa_temp;
      cwaHum = event.cwa_hum;
      cwaDailyHigh = event.cwa_daily_high;
      cwaDailyLow = event.cwa_daily_low;
      localTemp = event.local_temp;
      localHum = event.local_hum;
      motorStatus = event.local_jistatus ? "關" : "運轉中";
      gpsLat = event.local_gps_lat;
      gpsLong = event.local_gps_long;
      detectedList = event.local_detect;
      lightStatus = event.local_light ? "關" : "開";
      lightStatus2 = event.local_light ? "關" : "開";
      jistatus2 = event.local_jistatus ? "關" : "開";
      console.log(cwaType);
      console.log(cwaTemp);
      console.log(cwaHum);
      console.log(cwaDailyHigh);
      console.log(cwaDailyLow);
      console.log(localTemp);
      console.log(localHum);
      console.log(motorStatus);
      console.log(gpsLat);
      console.log(gpsLong);
      console.log(detectedList); 
      console.log(lightStatus);
    });
    async function fetchRemote() {
      const req = await fetch("/logger/jistatus");
      const res = await req.text();
      alert("已發送到伺服器");
      return res;
    }
    async function fetchGFA() {
      const req = await fetch("/logger/ledstatus");
      const res = await req.text();
      alert("已發送到伺服器");
      return res;
    }
  </script>
</html>
